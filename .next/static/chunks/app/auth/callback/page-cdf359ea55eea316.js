(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[453],{1910:function(e,s,n){Promise.resolve().then(n.bind(n,1099))},1099:function(e,s,n){"use strict";n.r(s),n.d(s,{default:function(){return u},dynamic:function(){return c}});var o=n(7437),r=n(2265),i=n(5475),t=n(2141),l=n(1968);let c="force-dynamic";function a(){let e=(0,i.useRouter)(),s=(0,i.useSearchParams)(),n=(0,t.e)();return(0,r.useEffect)(()=>{let o=setTimeout(async()=>{try{var o,r,i,t,l,c,a;console.log("Auth callback page loaded"),console.log("Current URL:",window.location.href);let u=window.location.hash;if(console.log("URL hash:",u),u&&u.includes("access_token")){console.log("Found access token in URL hash");let{data:s,error:t}=await n.auth.getSession();if(t){console.error("Session error after OAuth:",t),e.push("/?error=session_failed");return}if(s.session)console.log("Session created successfully:",null===(o=s.session.user)||void 0===o?void 0:o.email),window.history.replaceState({},document.title,"/auth/callback"),e.push("/");else{console.log("No session found, checking for manual token parsing");let{data:s,error:o}=await n.auth.setSession({access_token:new URLSearchParams(u.substring(1)).get("access_token")||"",refresh_token:new URLSearchParams(u.substring(1)).get("refresh_token")||""});o?(console.error("Manual session error:",o),e.push("/?error=manual_session_failed")):s.session?(console.log("Manual session created:",null===(i=s.session)||void 0===i?void 0:null===(r=i.user)||void 0===r?void 0:r.email),window.history.replaceState({},document.title,"/auth/callback"),e.push("/")):e.push("/?error=no_manual_session")}}else{let o=s.get("code");if(console.log("OAuth code:",o),o){let{data:s,error:r}=await n.auth.exchangeCodeForSession(o);if(r){console.error("Code exchange error:",r),e.push("/?error=code_exchange_failed");return}s.session?(console.log("Code exchange successful:",null===(l=s.session)||void 0===l?void 0:null===(t=l.user)||void 0===t?void 0:t.email),e.push("/")):e.push("/?error=no_session_from_code")}else{console.log("No tokens found, checking existing session");let{data:s,error:o}=await n.auth.getSession();if(o){console.error("Session check error:",o),e.push("/?error=session_check_failed");return}s.session?(console.log("Existing session found:",null===(a=s.session)||void 0===a?void 0:null===(c=a.user)||void 0===c?void 0:c.email),e.push("/")):(console.log("No session found, redirecting to home"),e.push("/?message=no_session"))}}}catch(s){console.error("Auth callback error:",s),e.push("/?error=unexpected")}},100);return()=>clearTimeout(o)},[e,s,n.auth]),(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"50vh",padding:"20px"},children:[(0,o.jsx)(l.Z,{}),(0,o.jsx)("p",{style:{marginTop:"20px",textAlign:"center"},children:"認証を完了しています..."})]})}function u(){return(0,o.jsx)(r.Suspense,{fallback:(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"50vh",padding:"20px"},children:[(0,o.jsx)(l.Z,{}),(0,o.jsx)("p",{style:{marginTop:"20px",textAlign:"center"},children:"読み込み中..."})]}),children:(0,o.jsx)(a,{})})}},1968:function(e,s,n){"use strict";var o=n(7437);n(2265),n(8487),s.Z=e=>{let{size:s="medium"}=e;return(0,o.jsx)("div",{className:"loading-spinner ".concat(s),children:(0,o.jsx)("div",{className:"spinner"})})}},2141:function(e,s,n){"use strict";n.d(s,{e:function(){return r}});var o=n(5452);let r=()=>(0,o.createClientComponentClient)();(0,o.createClientComponentClient)()},8487:function(){}},function(e){e.O(0,[338,452,971,117,744],function(){return e(e.s=1910)}),_N_E=e.O()}]);